XCOMM $XConsortium: Imakefile,v 1.166 93/09/26 15:41:16 gildea Exp $
/*
 * Server Master Makefile
 */

#include <Server.tmpl>

#define StdSubdirs dix os mi $(EXTDIRS)
#define MFBSubdirs StdSubdirs mfb
#define CFBSubdirs MFBSubdirs cfb cfb16 cfb32
#define CFB8Subdirs MFBSubdirs cfb
#define CFB16Subdirs MFBSubdirs cfb cfb16
#define CFB32Subdirs MFBSubdirs cfb cfb32
#define StdLibs $(DIX) $(OS) $(FONT) $(MI) $(EXTENSIONS)
#define MFBBareLibs $(DIX) $(OS) $(FONT) $(MFB) $(MI)
#define MFBLibs MFBBareLibs $(EXTENSIONS)
#define CFBBareLibs $(DIX) $(OS) $(FONT) $(CFB) $(MFB) $(MI)
#define CFBLibs CFBBareLibs $(EXTENSIONS)
#define CFB8BareLibs $(DIX) $(OS) $(FONT) $(CFB8) $(MFB) $(MI)
#define CFB8Libs CFB8BareLibs $(EXTENSIONS)
#define CFB16BareLibs $(DIX) $(OS) $(FONT) $(CFB16) $(MFB) $(MI)
#define CFB16Libs CFB16BareLibs $(EXTENSIONS)
#define CFB32BareLibs $(DIX) $(OS) $(FONT) $(CFB32) $(MFB) $(MI)
#define CFB32Libs CFB32BareLibs $(EXTENSIONS)

#if BuildPexExt
         PEXLIBS = PEX5/dipex/dispatch/libdidipex.a \
                   PEX5/dipex/swap/libdiswapex.a \
                   PEX5/dipex/objects/libdiobpex.a \
                   PEX5/dipex/dispatch/libdidipex.a \
                   PEX5/ddpex/mi/level4/libddpex4.a \
                   PEX5/ddpex/mi/level3/libddpex3.a \
                   PEX5/ddpex/mi/shared/libddpexs.a \
                   PEX5/ddpex/mi/level2/libddpex2.a \
                   PEX5/ddpex/mi/level1/libddpex1.a \
		   PEX5/ospex/libospex.a 
          PEXDIR = PEX5
#endif
#if BuildXInputExt
      XINPUTEXT = Xi/libxinput.a
          XIDIR = Xi
#endif
#if BuildXIE
      XIEEXT =  XIE/dixie/libdixie.a XIE/mixie/libmixie.a 
      XIEDIR = XIE
#endif
      OTHEREXTS = Xext/libext.a $(XINPUTEXT) $(XIEEXT)
        EXTDIRS = Xext $(XIDIR) $(XIEDIR) $(PEXDIR)
        DEPDIRS = $(FONTLIBSRC)
     EXTENSIONS = $(OTHEREXTS) $(PEXLIBS)
         XAULIB = $(XAUTHSRC)/libXau.a
#if HasKrb5
         DBMLIB =
#else
         DBMLIB = -ldbm
#endif
       XDMCPLIB = $(XDMCPLIBSRC)/libXdmcp.a
             OS = os/libos.a $(XAULIB) $(XDMCPLIB)
        BSDEMUL = $(DEPXBSDLIB)
            MFB = mfb/libmfb.a
            CFB = cfb/libcfb.a cfb16/libcfb.a cfb32/libcfb.a
            CFB8 = cfb/libcfb.a
            CFB16 = cfb/libcfb.a cfb16/libcfb.a
            CFB32 = cfb/libcfb.a cfb32/libcfb.a
             MI = mi/libmi.a
            DIX = dix/libdix.a
           FONT = $(DEPFONTLIB)
#if XirisServer || XhpServer || SystemV4 || defined(BSD386Architecture)
        SYSLIBS = MathLibrary Krb5Libraries
#else
        SYSLIBS = MathLibrary Krb5Libraries DBMLibrary
#endif
           CBRT = mi/cbrt.o

XCOMM
XCOMM This turns off the default rule for compiling .c files because
XCOMM this makefile does not really know how to build it.  This is really
XCOMM just a hack because of the Sun version of make and nfs.
XCOMM
.c.o:

/*****************************************************************************
 *		  ALL definitions, add one for each server                   *
 *****************************************************************************/

#if XqdssServer
ALL1 = Xqdss
#define realServer
#endif

#if XqvssServer
#if XqdssServer
ALL2 = Xqvss
#else
ALL1 = Xqvss
#define realServer
#endif
#endif

#if XdecServer
ALL1 = Xdec
#define realServer
#endif

#if XmfbpmaxServer
ALL1 = Xmfbpmax
#define realServer
#endif

#if XcfbpmaxServer
#if XmfbpmaxServer
ALL2 = Xcfbpmax
#else
ALL1 = Xcfbpmax
#define realServer
#endif
#endif

#if XsunServer || Xsun24Server
ALL1 = Xsun
#define realServer
#endif

#if XsunMonoServer
#if XsunServer || Xsun24Server
ALL2 = XsunMono
#else
ALL1 = XsunMono
#define realServer
#endif
#endif

#if XibmServer
ALL1 = Xibm
#define realServer
#endif

#if XtekServer
ALL1 = Xtek
#define realServer
#endif

#if XmacIIServer
ALL1 = XmacII
#define realServer
#endif

#if XlunaServer
ALL1 = Xluna
#define realServer
#endif

#if XmipsServer
ALL1 = Xmips
#define realServer
#endif

#if XnonServer
ALL1 = Xnon
#endif

#if XirisServer
ALL1 = Xiris
#define realServer
#endif

#if XhpServer
ALL1 = Xhp
#define realServer
#endif

#if XsvgaServer
ALL1 = Xsvga
#define realServer
#endif

#if XnestServer
ALL3 = Xnest
#endif

/* end ALL definitions */

ALL = $(ALL1) $(ALL2) $(ALL3)

all: $(ALL)


/*****************************************************************************
 *		  Build rule blocks, add one for each server                 *
 *****************************************************************************/


#if XqdssServer
XCOMM
XCOMM Digital qdss server
XCOMM
SUBDIRS0 = MFBSubdirs hw/dec/lk201
SUBDIRS1 = hw/dec/qdss hw/dec/qdss/libtl
QDSSDIRS = $(SUBDIRS0) $(SUBDIRS1) $(DEPDIRS)
QDSSOBJS = hw/dec/qdss/init.o hw/dec/qdss/qdss_io.o hw/dec/lk201/lk201.o
QDSSLIBS = hw/dec/qdss/libqdss.a hw/dec/qdss/libtl/libtl.a \
           hw/dec/qdss/libqdss.a MFBLibs

ServerTarget(Xqdss,$(QDSSDIRS),$(QDSSOBJS),$(QDSSLIBS),$(SYSLIBS))
#endif /* XqdssServer */


#if XqvssServer
XCOMM
XCOMM Digital qvss server
XCOMM
SUBDIRS0 = MFBSubdirs hw/dec/lk201
SUBDIRS2 = hw/dec/qvss
QVSSDIRS = $(SUBDIRS0) $(SUBDIRS2) $(DEPDIRS)
QVSSOBJS = hw/dec/qvss/init.o hw/dec/qvss/qvss_io.o hw/dec/lk201/lk201.o
QVSSLIBS = MFBLibs

ServerTarget(Xqvss,$(QVSSDIRS),$(QVSSOBJS),$(QVSSLIBS),$(SYSLIBS))
#endif /* XqvssServer */


#if XdecServer
XCOMM
XCOMM Digital MIPS based WS server (ultrix 4.2 and beyond)
XCOMM
SUBDIRS0 = CFBSubdirs hw/dec/ws
DECDIRS = $(SUBDIRS0) $(DEPDIRS)
DECOBJS = hw/dec/ws/init.o
DECLIBS = hw/dec/ws/libdec.a CFBLibs

ServerTarget(Xdec,$(DECDIRS),$(DECOBJS),$(DECLIBS),$(SYSLIBS))
#endif /* XdecServer */


#if XmfbpmaxServer
XCOMM
XCOMM Digital mfbpmax server
XCOMM
SUBDIRS0 = MFBSubdirs
SUBDIRS2 = hw/dec/lk201
SUBDIRS3 = hw/dec/mfbpmax
PMAXMFBDIRS = $(SUBDIRS0) $(SUBDIRS2) $(SUBDIRS3) $(DEPDIRS)
PMAXMFBOBJS = hw/dec/mfbpmax/init.o hw/dec/mfbpmax/mfbpmax_io.o hw/dec/lk201/lk201.o
PMAXMFBLIBS = MFBLibs

ServerTarget(Xmfbpmax,$(PMAXMFBDIRS),$(PMAXMFBOBJS),$(PMAXMFBLIBS),$(SYSLIBS))
#endif /* XmfbpmaxServer */


#if XcfbpmaxServer
XCOMM
XCOMM Digital cfbpmax server
XCOMM
SUBDIRS0 = MFBSubdirs
SUBDIRS1 = cfb hw/dec/cfbpmax
SUBDIRS2 = hw/dec/lk201
PMAXCFBDIRS = $(SUBDIRS0) $(SUBDIRS1) $(SUBDIRS2) $(DEPDIRS)
PMAXCFBOBJS = hw/dec/cfbpmax/init.o hw/dec/cfbpmax/cfbpmax_io.o \
	hw/dec/cfbpmax/cfbpmaxcolor.o hw/dec/lk201/lk201.o
PMAXCFBLIBS = CFB8Libs

ServerTarget(Xcfbpmax,$(PMAXCFBDIRS),$(PMAXCFBOBJS),$(PMAXCFBLIBS),$(SYSLIBS))
#endif /* XcfbpmaxServer */


#if XsunServer
XCOMM
XCOMM Sun server
XCOMM
SUBDIRS0 = MFBSubdirs
SUBDIRS1 = cfb
SUBDIRS2 = hw/sun
SUNDIRS = $(SUBDIRS0) $(SUBDIRS1) $(SUBDIRS2) $(DEPDIRS)
SUNOBJS = hw/sun/sunInit.o
SUNLIBS = hw/sun/libsun.a CFB8Libs
SUNSYSLIBS = $(SYSLIBS)

ServerTarget(Xsun,$(SUNDIRS),$(SUNOBJS),$(SUNLIBS),$(SUNSYSLIBS))
#else
#if Xsun24Server
XCOMM
XCOMM Sun server
XCOMM
SUBDIRS0 = MFBSubdirs
SUBDIRS1 = cfb cfb16 cfb32
SUBDIRS2 = hw/sun
SUNDIRS = $(SUBDIRS0) $(SUBDIRS1) $(SUBDIRS2) $(DEPDIRS)
SUNOBJS = hw/sun/sunInit.o
SUNLIBS = hw/sun/libsun.a CFBLibs
SUNSYSLIBS = $(SYSLIBS)

ServerTarget(Xsun,$(SUNDIRS),$(SUNOBJS),$(SUNLIBS),$(SUNSYSLIBS))
#endif /* Xsun24Server */
#endif /* XsunServer */

#if XsunMonoServer
XCOMM
XCOMM Sun monochrome server
XCOMM
SUBDIRS0 = MFBSubdirs
SUBDIRS2 = hw/sun
SUNMDIRS = $(SUBDIRS0) $(SUBDIRS2) $(DEPDIRS)
SUNMOBJS = hw/sun/sunInitMono.o hw/sun/sunInitExtMono.o
SUNMLIBS = hw/sun/libsun.a MFBBareLibs $(OTHEREXTS)
SUNSYSLIBS = $(SYSLIBS)

ServerTarget(XsunMono,$(SUNMDIRS),$(SUNMOBJS),$(SUNMLIBS),$(SUNSYSLIBS))
#endif /* XsunMonoServer */


#if XibmServer
XCOMM
XCOMM IBM server
XCOMM
#if SpecialMalloc
IBMALLOCLIB = hw/ibm/common/libibmalloc.a
#else
IBMALLOCLIB = 
#endif
SUBDIRS0 = CFB8Subdirs hw/ibm
IBMDIRS = $(SUBDIRS0) $(DEPDIRS)
IBMOBJS = hw/ibm/common/ibmcomm.o hw/ibm/common/ibmDate.o
IBMLIBS = hw/ibm/AIX/hft.o hw/ibm/libibm.a $(IBMALLOCLIB) CFB8Libs

ServerTarget(Xibm,$(IBMDIRS),$(IBMOBJS),$(IBMLIBS),$(SYSLIBS))
#endif /* XibmServer */


#if XtekServer
XCOMM
XCOMM Tektronix server
XCOMM
SUBDIRS0 = CFB8Subdirs hw/tek
TEKDIRS = $(SUBDIRS0) $(DEPDIRS)
TEKOBJS = hw/tek/pegInit.o
TEKLIBS = hw/tek/libtek.a CFB8Libs
TEKSYSLIBS = $(CBRT) $(SYSLIBS)

ServerTarget(Xtek,$(TEKDIRS),$(TEKOBJS),$(TEKLIBS),$(TEKSYSLIBS))
#endif /* XtekServer */


#if XmacIIServer
XCOMM
XCOMM Apple MacII server
XCOMM
SUBDIRS0 = CFB8Subdirs hw/macII
MACIIDIRS = $(SUBDIRS0) $(DEPDIRS)
MACIIOBJS = hw/macII/macIIInitS.o hw/macII/macIIColor.o
MACIILIBS = hw/macII/libmacII.a CFB8Libs
MACIISYSLIBS = $(CBRT) $(SYSLIBS)
 
ServerTarget(XmacII,$(MACIIDIRS),$(MACIIOBJS),$(MACIILIBS),$(MACIISYSLIBS))
#endif /* XmacIIServer */


#if XlunaServer
XCOMM
XCOMM OMRON Luna server
XCOMM
SUBDIRS0 = MFBSubdirs hw/omron
LUNADIRS = $(SUBDIRS0) $(DEPDIRS)
LUNAOBJS = hw/omron/omronInit.o
#ifdef uniosu
LUNALIBS = hw/omron/libomron.a MFBLibs $(BSDEMUL)
#else
LUNALIBS = hw/omron/libomron.a MFBLibs
#endif

ServerTarget(Xluna,$(LUNADIRS),$(LUNAOBJS),$(LUNALIBS),$(SYSLIBS))
#endif /* XlunaServer */


#if XmipsServer
XCOMM
XCOMM MIPS server
XCOMM
SUBDIRS0 = CFB8Subdirs hw/mips
MIPSDIRS = $(SUBDIRS0) $(DEPDIRS)
MIPSOBJS = hw/mips/mipsInit.o
MIPSLIBS = hw/mips/libmips.a CFB8Libs
MIPSSYSLIBS = $(SYSLIBS) -lc /usr/lib/libc.a
 
ServerTarget(Xmips,$(MIPSDIRS),$(MIPSOBJS),$(MIPSLIBS),$(MIPSSYSLIBS))
#endif /* XmipsServer */


#if XirisServer
XCOMM
XCOMM SGI Iris Server
XCOMM
SGIDIRS = hw/sgi/IRIX hw/sgi/common hw/sgi/gr1 hw/sgi/nfb hw/sgi/rrm \
	hw/sgi/sgi
SUBDIRS0 = CFBSubdirs $(SGIDIRS)
IRISDIRS = $(SUBDIRS0) $(DEPDIRS)
IRISOBJS =
IRISLIBS = 	$(DIX) $(OS) \
		hw/sgi/common/libcomm.a \
		hw/sgi/sgi/libsgi.a \
	   	hw/sgi/gr1/re2/libre2.a \
	   	hw/sgi/gr1/libgr1.a \
	   	hw/sgi/rrm/librrm.a \
		hw/sgi/nfb/libnfb.a \
		$(CFB) $(MFB) $(MI) $(FONT) $(EXTENSIONS) \
		hw/sgi/IRIX/libirix.a
IRISSYSLIBS = $(SYSLIBS)
 
ServerTarget(Xiris,$(IRISDIRS),$(IRISOBJS),$(IRISLIBS),$(IRISSYSLIBS))
#endif /* XirisServer */

#if XhpServer
XCOMM
XCOMM Hewlett Packard CFB Server
XCOMM
SUBDIRS0 = CFB32Subdirs hw/hp
HPSUBDIRS = $(SUBDIRS0) $(DEPDIRS)
HPOBJS = hw/hp/hp.o
HPLIBS = CFB32Libs
HPSYSLIBS = $(CBRT) $(SYSLIBS) /usr/lib/libdbm.a -ldld
ServerTarget(Xhp,$(HPSUBDIRS),$(HPOBJS),$(HPLIBS),$(HPSYSLIBS))
#endif	/* XhpServer */

#if XsvgaServer
XCOMM
XCOMM SVGA CFB Server
XCOMM
INSTPGMFLAGS = InstPgmFlags $(INSTUIDFLAGS) /* server must be suid root  */
SUBDIRS0 = CFB8Subdirs hw/svga
SVGASUBDIRS = $(SUBDIRS0)
SVGAOBJS = hw/svga/svga.o
SVGALIBS = CFB8Libs
SVGASYSLIBS = $(CBRT) -lm -lmalloc
ServerTarget(Xsvga,$(SVGASUBDIRS),$(SVGAOBJS),$(SVGALIBS),$(SVGASYSLIBS))
#endif	/* XsvgaServer */

#if XnestServer
#ifndef realServer
SUBDIRS0 = StdSubdirs
#endif
SUBDIRS4 = hw/xnest
XNESTDIRS = StdSubdirs $(SUBDIRS4) $(DEPDIRS)
XNESTOBJS = 
XNEST = hw/xnest/libxnest.a
XNESTLIBS = $(DIX) $(OS) $(FONT) $(XNEST) $(MI) $(EXTENSIONS)
XNESTSYSLIBS = $(LDPRELIB) $(XLIB) $(SYSLIBS)

ServerTarget(Xnest,$(XNESTDIRS),$(XNESTOBJS),$(XNESTLIBS),$(XNESTSYSLIBS))
#endif /* XnestServer */

#if XnonServer
XCOMM
XCOMM non server, just compile sources for build test
XCOMM
SUBDIRS0 = CFBSubdirs

Xnon: $(SUBDIRS0) $(DEPDIRS)

#endif /* XnonServer */


SUBDIRS = $(SUBDIRS0) $(SUBDIRS1) $(SUBDIRS2) $(SUBDIRS3) $(SUBDIRS4)

#ifdef realServer
install::
	-(cd $(DESTDIR)$(BINDIR); $(RM) X; $(LN) $(ALL1) X)
#endif

#define IHaveSubdirs

DependSubdirs($(SUBDIRS))
MakeLintLibSubdirs($(SUBDIRS))
LintSubdirs($(SUBDIRS))

ForceSubdirs($(DEPDIRS) $(SUBDIRS))

InstallManPage(Xserver,$(MANDIR))
