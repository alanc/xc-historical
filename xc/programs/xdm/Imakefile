#if InstallXdmConfig
#define IHaveSubdirs
#define PassCDebugFlags 'CDEBUGFLAGS=$(CDEBUGFLAGS)'
#endif

#if HasDESLibrary
DES_DEFINES = -DHASDES
DESOBJS = xdmauth.o
DESSRCS = xdmauth.c
#else
DES_DEFINES = 
DESOBJS =
DESSRCS = 
#endif

#if HasSecureRPC
RPC_DEFINES = -DSECURE_RPC
RPCOBJS = rpcauth.o
RPCSRCS = rpcauth.c
RPCLIB = -lrpcsvc
#else
RPC_DEFINES = 
RPCOBJS =
RPCSRCS = 
RPCLIB =
#endif

   XDMCONFIGDIR = XdmConfigurationSubdirectory
        SUBDIRS = $(XDMCONFIGDIR)

DEPLIBS = $(DEPXAWLIB) $(DEPXMULIB) $(DEPXTOOLLIB) $(DEPXLIB) \
	  $(TOP)/lib/Xau/libXau.a $(TOP)/lib/Xdmcp/libXdmcp.a
LOCAL_LIBRARIES = $(XAWLIB) $(XMULIB) $(XTOOLLIB) \
		  $(TOP)/lib/Xau/libXau.a $(TOP)/lib/Xdmcp/libXdmcp.a \
 		  $(XLIB) $(RPCLIB)
          SRCS1 = auth.c daemon.c server.c dpylist.c dm.c error.c \
		  file.c greet.c reset.c resource.c protodpy.c policy.c \
		  session.c socket.c util.c verify.c Login.c mitauth.c \
		  cryptokey.c access.c choose.c $(DESSRCS) $(RPCSRCS)
          OBJS1 = auth.o daemon.o server.o dpylist.o dm.o error.o \
		  file.o greet.o reset.o resource.o protodpy.o policy.o \
		  session.o socket.o util.o verify.o Login.o mitauth.o \
		  cryptokey.o access.o choose.o $(DESOBJS) $(RPCOBJS)
          SRCS2 = xdmshell.c 
          OBJS2 = xdmshell.o 
#if SystemV
          SRCS3 = /**/
          OBJS3 = /**/
#else
          SRCS3 = chooser.c
          OBJS3 = chooser.o
#endif
       DEPLIBS3 = XawClientDepLibs $(TOP)/lib/Xdmcp/libXdmcp.a
       
          SRCS4 = sessreg.c
          OBJS4 = sessreg.o
#if SystemV
       PROGRAMS = xdm xdmshell sessreg
#else
       PROGRAMS = xdm xdmshell sessreg chooser
#endif

 OSMAJORVERSION = OSMajorVersion
 OSMINORVERSION = OSMinorVersion
        DEFINES = -DBINDIR=\"$(BINDIR)\" -DXDMDIR=\"$(XDMDIR)\" \
		$(SIGNAL_DEFINES) $(DES_DEFINES) $(RPC_DEFINES) ConnectionFlags \
		-DOSMAJORVERSION=$(OSMAJORVERSION) \
		-DOSMINORVERSION=$(OSMINORVERSION)

XCOMM
XCOMM Special definitions for compiling default resources; these parameters
XCOMM should be set in util/imake.includes/site.def or the appropriate .macros
XCOMM file in that directory.  The lack of initial spaces is to prevent imake
XCOMM from accidently turning the lines into rules by putting a leading tab.
XCOMM
XCOMM Do NOT change these lines!
XCOMM
DEF_SERVER = $(BINDIR)/X
DEF_USER_PATH = DefaultUserPath		/* no leading spaces or imake will */
DEF_SYSTEM_PATH = DefaultSystemPath	/* indent as rule */
BOURNE_SHELL = DefaultSystemShell
CPP_PROGRAM = CppCmd
RES_DEFINES = '-DDEF_SERVER_LINE=":0 local $(DEF_SERVER) :0"' \
		  '-DXRDB_PROGRAM="$(BINDIR)/xrdb"' \
		  '-DDEF_SESSION="$(BINDIR)/xterm -ls"' \
		  '-DDEF_USER_PATH="$(DEF_USER_PATH)"' \
		  '-DDEF_SYSTEM_PATH="$(DEF_SYSTEM_PATH)"' \
		  '-DDEF_SYSTEM_SHELL="$(BOURNE_SHELL)"' \
		  '-DDEF_FAILSAFE_CLIENT="$(BINDIR)/xterm"' \
		  '-DDEF_XDM_CONFIG="$(XDMDIR)/xdm-config"' \
		  '-DDEF_AUTH_DIR="$(XDMDIR)"' \
		  '-DDEF_KEY_FILE="$(XDMDIR)/Xkeys"' \
		  '-DDEF_ACCESS_FILE="$(XDMDIR)/Xaccess"' \
		  '-DCPP_PROGRAM="$(CPP_PROGRAM)"'

ComplexProgramTarget_1(xdm,$(LOCAL_LIBRARIES), /**/)
SingleProgramTarget(xdmshell,$(OBJS2), /**/, /**/)
SingleProgramTarget(sessreg,$(OBJS4), /**/, /**/)
#if !SystemV
ComplexProgramTarget_3(chooser,XawClientLibs $(TOP)/lib/Xdmcp/libXdmcp.a, /**/)
#endif

SpecialObjectRule(resource.o, $(ICONFIGFILES), $(RES_DEFINES))

# these files depend on HASDES
auth.o policy.o: $(ICONFIGFILES)

#ifdef IHaveSubdirs
MakeDirectories(install,$(XDMDIR))
MakeSubdirs($(SUBDIRS))
#endif

/*
 * Don't install; let people read the instructions about putting in the
 * abort-display() resource:
 */
#ifdef comment
InstallProgramWithFlags(xdmshell,$(BINDIR), /**/)
#endif
