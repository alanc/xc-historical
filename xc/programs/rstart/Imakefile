XCOMM $XConsortium$
XCOMM
XCOMM Copyright (c) 1993 Quarterdeck Office Systems
XCOMM
XCOMM Permission to use, copy, modify, distribute, and sell this software
XCOMM and software and its documentation for any purpose is hereby granted
XCOMM without fee, provided that the above copyright notice appear in all
XCOMM copies and that both that copyright notice and this permission
XCOMM notice appear in supporting documentation, and that the name
XCOMM Quarterdeck Office Systems, Inc. not be used in advertising or
XCOMM publicity pertaining to distribution of this software without
XCOMM specific, written prior permission.
XCOMM
XCOMM THIS SOFTWARE IS PROVIDED `AS-IS'.  QUARTERDECK OFFICE SYSTEMS,
XCOMM INC., DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,
XCOMM INCLUDING WITHOUT LIMITATION ALL IMPLIED WARRANTIES OF
XCOMM MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR
XCOMM NONINFRINGEMENT.  IN NO EVENT SHALL QUARTERDECK OFFICE SYSTEMS,
XCOMM INC., BE LIABLE FOR ANY DAMAGES WHATSOEVER, INCLUDING SPECIAL,
XCOMM INCIDENTAL OR CONSEQUENTIAL DAMAGES, INCLUDING LOSS OF USE, DATA, OR
XCOMM PROFITS, EVEN IF ADVISED OF THE POSSIBILITY THEREOF, AND REGARDLESS
XCOMM OF WHETHER IN AN ACTION IN CONTRACT, TORT OR NEGLIGENCE, ARISING OUT
XCOMM OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

XCOMM $XConsortium: Imakefile,v 1.5 94/02/06 14:35:36 rws Exp $

XCOMM Having had to change the name once, I don't want it to be tough
XCOMM the next time...
SERVERNAME=rstartd
CLIENTNAME=rstart
MYLIBDIR=LibDir/rstart
ENVPREFIX=RSTART
PACKAGEname=rstart

#if	!defined(UsrBin)
#define	UsrBin	/usr/bin
#endif

#if	!defined(RshCmd)
# if	SystemV
#  ifdef HPArchitecture
#   define	RshCmd	remsh
#  else
#   define	RshCmd	rcmd
#  endif
# else
#  define	RshCmd	rsh
# endif
#endif

RSHCMD=RshCmd

           SRCS = server.c auth.c
           OBJS = server.o auth.o

SRVDEFS = -DSERVERNAME=\"$(SERVERNAME)\" -DDEFAULT_CONFIG=\"$(MYLIBDIR)/config\"
#if !HasPutenv
PEDEFS = -DNOPUTENV
#endif

AllTarget($(SERVERNAME).real)
NormalProgramTarget($(SERVERNAME).real, $(OBJS),NullParameter,NullParameter,NullParameter)
InstallProgram($(SERVERNAME).real,$(MYLIBDIR))

SpecialCObjectRule(server,NullParameter,$(SRVDEFS) $(PEDEFS))

AllTarget($(SERVERNAME))
CppScriptTarget($(SERVERNAME),server.cpp,-DLIBDIR=$(MYLIBDIR) -DSERVERNAME=$(SERVERNAME),NullParameter)
InstallProgram($(SERVERNAME),UsrBin)

AllTarget($(CLIENTNAME))
CppScriptTarget($(CLIENTNAME),client.cpp,-DRSHCMD=$(RSHCMD) -DSERVERNAME=$(SERVERNAME),NullParameter)
InstallProgram($(CLIENTNAME),BinDir)

AllTarget(config)
CppFileTarget(config,config.cpp,-DBINDIR=$(BINDIR) -DLIBDIR=$(MYLIBDIR) -DPACKAGEname=$(PACKAGEname) -DENVPREFIX=$(ENVPREFIX),NullParameter)
InstallNonExecFile(config,$(MYLIBDIR))

#define	MakeDirFunc(src, dest)						\
	if test ! -d dest;						\@@\
	then								\@@\
		mkdir dest;						\@@\
	fi

/* This is ugly.  Suggested change to Imake.tmpl:			*/
/*	#ifndef SystemManDirectory					*/
/*	#if SystemV4							*/
/*	#define SystemManDirectory /usr/share/man			*/
/*	#else								*/
/*	#define SystemManDirectory /usr/man				*/
/*	#endif								*/
/*	#endif								*/
/*	#ifndef ManDirectoryRoot					*/
/*	#ifdef ProjectRoot						*/
/*	#define ManDirectoryRoot Concat(ProjectRoot,/man)		*/
/*	#else								*/
/*	#define ManDirectoryRoot SystemManDirectory			*/
/*	#endif								*/
/*	#endif								*/

/* If the above change is made, then the next paragraph can disappear. */
#ifndef	SystemManDirectory
#if SystemV4
#define SystemManDirectory /usr/share/man
#else
#define SystemManDirectory /usr/man
#endif
#endif

#ifdef	ProjectRoot
DEFAULT_X_MANPATH=$(MANPATH):SystemManDirectory
#else
DEFAULT_X_MANPATH=SystemManDirectory
#endif

DEFAULT_USER_PATH=DefaultUserPath

#define	FilterContext(src, dest)					\
	RemoveFile(dest);						\@@\
	sed								\@@\
		-e 's,_PATH,$(DEFAULT_USER_PATH),g'			\@@\
		-e 's,_MANPATH,$(DEFAULT_X_MANPATH),g'			\@@\
		< src > dest

#define	FilterCommand(src, dest)					\
	RemoveFile(dest);						\@@\
	sed								\@@\
		-e 's,ENVPREFIX,$(ENVPREFIX),g'				\@@\
		< src > dest;						\@@\
	case `basename dest` in						\@@\
	@*)								\@@\
		;;							\@@\
	*)								\@@\
		chmod +x dest ;;					\@@\
	esac

#define	Recurse(src, dest, filefunc, dirfunc)				\
	set -x;								\@@\
	find src -print |						\@@\
		while read name;					\@@\
		do							\@@\
			if test -f $$name;				\@@\
			then						\@@\
				filefunc($$name,dest/$$name);		\@@\
			else						\@@\
				dirfunc($$name,dest/$$name);		\@@\
			fi;						\@@\
 		done

#if	HasSymLinks
#define	InstallAliases()						\
	set -x;								\@@\
 	cd $(MYLIBDIR)/contexts;					\@@\
 		sed -e '/^$$/d' -e '/^#/d' @Aliases |			\@@\
 		while read real aliases;				\@@\
 		do							\@@\
 			for i in $$aliases;				\@@\
 			do						\@@\
 				rm -f $$i;				\@@\
 				$(LN) $$real $$i;			\@@\
 				rm -f $(MYLIBDIR)/commands/$$i;		\@@\
 				$(LN) $$real $(MYLIBDIR)/commands/$$i;	\@@\
 			done;						\@@\
 		done;							\@@\
 		rm @Aliases
#else
#define	InstallAliases()						\
	echo "Sorry:  don't yet know how to install aliases without symlinks"
#endif

install::
	Recurse(commands,$(MYLIBDIR),FilterCommand,MakeDirFunc)
	Recurse(contexts,$(MYLIBDIR),FilterContext,MakeDirFunc)
	InstallAliases()

XCOMM # Turning this on makes the server look up host names in $DISPLAY and
XCOMM # substitute IP addresses.  (ODT v1 X clients can't look names up in
XCOMM # DNS.)
XCOMM #CFLAGS=-DODT1_DISPLAY_HACK

depend::
