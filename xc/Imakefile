#define IHaveSubdirs
#define PassCDebugFlags

      WORLDOPTS = -k
BOOTSTRAPCFLAGS = 
        CHECKFN = $(UTILSRC)/checkfn

/**/#
/**/# Preserve this order!
/**/#
  LIBDIRSTOMAKE = \
		$(INCLUDESRC) \
		$(LIBSRC) \
		$(EXTENSIONSRC) 
#ifndef ClientSideOnly
SERVERDIRSTOMAKE = \
		$(SERVERSRC) \
		$(FONTSRC) 
#endif
CLIENTDIRSTOMAKE = \
		$(CLIENTSRC) \
		$(DEMOSRC) \
		$(EXAMPLESRC)
     DIRSTOMAKE = \
		$(LIBDIRSTOMAKE) \
		$(SERVERDIRSTOMAKE) \
		$(CLIENTDIRSTOMAKE) 
        SUBDIRS = \
		$(DIRSTOMAKE) \
		$(UTILSRC) \
		$(XMANSRC)
  LNINSTALLDIRS = \
		$(EXTENSIONSRC) \
		$(LIBSRC)

MakeSubdirs($(DIRSTOMAKE) $(RGBSRC) $(XMANSRC))

install.ln::
	-mkdir $(LINTLIBDIR)

MakeLintSubdirs($(LNINSTALLDIRS),install.ln,install.ln)

MakeLintSubdirs($(LNINSTALLDIRS),external.ln,lintlib)


/**/#
/**/# before depending, be sure that include has everything in it.
/**/#
depend::
	cd $(INCLUDESRC); $(MAKE)

DependSubdirs($(SUBDIRS))


/**/# 
/**/# install stuff; create the directories that we're going to need
/**/# 

#ifndef ClientSideOnly
  DIRS_SERVER = $(FONTDIR) /* $(ADMDIR) */
#endif
#if InstallxinitConfig
   DIRS_XINIT = $(XINITDIR)
#endif
#if InstallxdmConfig
     DIRS_XDM = $(XDMDIR)
#endif
#if InstallAppDefFiles
  DIRS_APPDEF = $(XAPPLOADDIR)
#endif

 DIRS_CONTRIB = /* $(AWMDIR) $(TWMDIR) */

DIRS_TO_BUILD = $(DIRS_SERVER) \
	$(USRLIBDIR) $(BINDIR) $(INCDIR) $(LIBDIR) /* $(LINTLIBDIR) */ \
	$(DIRS_XINIT) $(DIRS_XDM) $(DIRS_APPDEF) \
	$(UWMDIR) $(DIRS_CONTRIB)

MakeDirectories(install, $(DIRS_TO_BUILD))

MakeDirectories(install.man, $(MANPATH) $(MANDIR) $(LIBMANDIR))
InstallManPage(X,$(MANDIR))


/**/# don't name your log file make.log when you run this ...
World::
	@echo ""
	@echo "Building Release 3 of the X Window System"
	@echo ""
	@echo "**************************************************************"
	@echo "* Did you remember to check the configuration parameters in  *
	@echo "* the directory util/imake.includes and set BOOTSTRAPCFLAGS? *"
	@echo "**************************************************************"
	@echo ""
	@echo "Making imake; BOOTSTRAPCFLAGS better be right..."
	@date
	cd $(IMAKESRC); $(MAKE) clean; $(MAKE) BOOTSTRAPCFLAGS="$(BOOTSTRAPCFLAGS)"
	-$(MV) Makefile Makefile.bak
	@echo "Making new, system-dependent makefiles from Imakefiles"
	@date
	$(MAKE) -f Makefile.bak Makefile
	$(MAKE) Makefiles
	@echo "Doing make clean to get rid of any previous build."
	@date
	$(MAKE) clean
	@echo "Appending dependencies to Makefiles"
	@date
	$(MAKE) depend
	@echo "Starting compile of core distribution."
	@date
	$(MAKE) $(WORLDOPTS)
	@echo "Build of the X Window System complete."
	@date

Everything::
	cd $(IMAKESRC); $(MAKE) BOOTSTRAPCFLAGS="$(BOOTSTRAPCFLAGS)"
	-$(MV) Makefile Makefile.bak
	$(MAKE) -f Makefile.bak Makefile
	$(MAKE) Makefiles
	$(MAKE) depend
	$(MAKE) $(WORLDOPTS)

CHANGES.ALL::
	$(RM) $@
	(for i in `find . -name CHANGES -print`; do \
	echo $$i; echo ""; cat $$i; echo ""; \
	echo "==========================================================="; \
	done) >$@

/*
 * This section used for generating distributions will not be useful to most
 * people.
 */
/**/# check all filenames for length, letters, and content
checkfilenames::  $(CHECKFN)/checkfn
	@find . -type d -exec $(CHECKFN)/find.sh $(CHECKFN)/checkfn {} \;

